"use strict";(self.webpackChunkreact_dev=self.webpackChunkreact_dev||[]).push([[251],{251:(e,t,n)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function r(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}function i(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.r(t),n.d(t,{default:()=>x,formatRollResults:()=>v,rollDice:()=>b,rollFromText:()=>h,rollOnce:()=>f,trimMessage:()=>p});var l=n(43),c=n(579);const d=/(?<!\d)(\d*)\s*[dD]\s*(\d+)(?!\d)/g,u=[{id:"q1",text:"You rolled a dice with 4 sides: 1d4",bg:"".concat("/React_MiniGames","/image/4sides.png")},{id:"q2",text:"You rolled a dice with 6 sides: 1d6",bg:"".concat("/React_MiniGames","/image/6sides.png")},{id:"q3",text:"You rolled a dice with 10 sides: 1d10",bg:"".concat("/React_MiniGames","/image/10sides.png")},{id:"q4",text:"You rolled a dice with 12 sides: 1d12",bg:"".concat("/React_MiniGames","/image/12sides.png")},{id:"q5",text:"You rolled a dice with 100 sides: 1d100",bg:"".concat("/React_MiniGames","/image/20sides.png")}],m=e=>{var t;return"reply"===e.type&&"roll"===(null===(t=e.content)||void 0===t?void 0:t.kind)?v(e.content.results):e.content};function p(e){const t=[];let n;for(;null!==(n=d.exec(e));){const e=n[1]?parseInt(n[1],10):1,s=parseInt(n[2],10);e>0&&s>0&&t.push({count:e,sides:s,raw:n[0].trim()})}return t}function f(e){return Math.floor(Math.random()*e)+1}function b(e,t){const n=Array.from({length:e},()=>f(t)),s=n.reduce((e,t)=>e+t,0);return{rolls:n,total:s}}function h(e){return p(e).map(e=>o({spec:e},b(e.count,e.sides)))}function v(e){if(!e||0===e.length)return null;const t=e.map((e,t)=>{const n=e.rolls.join(", ");return(0,c.jsxs)("div",{className:"dice-line",children:["\ud83c\udfb2Results :"," ",(0,c.jsx)("span",{className:"dice-total",children:e.total}),"  (",(0,c.jsx)("span",{className:"dice-rolls",children:n}),")"]},t)});if(e.length>1){const n=e.reduce((e,t)=>e+t.total,0);t.push((0,c.jsxs)("div",{className:"dice-grand",children:["Total Sum: ",(0,c.jsx)("span",{className:"dice-grand-total",children:n})]},"grand"))}return(0,c.jsx)("div",{className:"dice-results",children:t})}function x(){const[e,t]=(0,l.useState)([]),[n,s]=(0,l.useState)(""),[r,i]=(0,l.useState)(!1),[a,d]=(0,l.useState)(null),[p,f]=(0,l.useState)(null),[b,v]=(0,l.useState)(""),[x,g]=(0,l.useState)({}),y=(0,l.useRef)(null),j=(0,l.useRef)(null),N=()=>{var e;return null!==(e=crypto)&&void 0!==e&&e.randomUUID?crypto.randomUUID():Date.now().toString()},w=e=>e.map(e=>o({},e)),I=(e,t)=>e.length===t.length&&e.every((e,n)=>e.id===t[n].id&&e.type===t[n].type&&e.content===t[n].content);(0,l.useEffect)(()=>{g(t=>{let n=!1;const s=o({},t);for(const[r,i]of Object.entries(t)){const t=e.findIndex(e=>e.id===r);if(-1!==t){const a=w(e.slice(t+1)),l=i.versions[i.currentIndex];if(!I(l.suffix,a)){const e=i.versions.slice();e[i.currentIndex]=o(o({},l),{},{suffix:a}),s[r]=o(o({},i),{},{versions:e}),n=!0}}}return n?s:t}),(()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[e]);const S=async e=>{i(!0),d(null);try{var n;const s=[...e].reverse().find(e=>"user"===e.type),r=h(null!==(n=null===s||void 0===s?void 0:s.content)&&void 0!==n?n:"");if(!r.length)return;t(e=>[...e,{type:"reply",content:{kind:"roll",results:r},id:N()}])}finally{var s;i(!1),null===(s=j.current)||void 0===s||s.focus()}},O=()=>{f(null),v("")},k=(e,n)=>{g(s=>{const r=s[e];if(!r)return s;const i=Math.max(0,Math.min(r.versions.length-1,r.currentIndex+n));if(i===r.currentIndex)return s;const a=r.versions[i];return t(t=>{const n=t.findIndex(t=>t.id===e);if(-1===n)return t;return[...w(t.slice(0,n)),o(o({},t[n]),{},{content:a.content}),...w(a.suffix)]}),o(o({},s),{},{[e]:o(o({},r),{},{currentIndex:i})})})};return(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"dice-title",children:(0,c.jsx)("strong",{children:"\ud83c\udfb2 Table Dice Roller \ud83c\udfb2"})}),(0,c.jsxs)("div",{className:"dice-instruction",children:[(0,c.jsx)("p",{children:"Please type \"number of dice + 'd' + number of sides on the dice\" to roll the dice"}),(0,c.jsx)("p",{children:"This app is aimed to log and track your dice numbers and what happens when playing table games"}),(0,c.jsx)("p",{children:"Feel free to type some notes, it will keep your notes until you reload this web page"}),(0,c.jsx)("p",{children:"Example of use:"}),(0,c.jsx)("p",{children:'"I got damaged from a ghoul, received damage 1 d 6"'}),(0,c.jsx)("p",{children:'"I observed a murder, my sanity got hurt 1 d 4"'})]}),(0,c.jsxs)("div",{className:"chat-container",children:[(0,c.jsxs)("div",{className:"messages",children:[e.map(n=>{const s=p===n.id,i=x[n.id],a=!!i&&i.versions.length>=1,l=a&&i.currentIndex>0,d=a&&i.currentIndex<i.versions.length-1;return(0,c.jsx)("div",{className:"message ".concat(n.type),children:s?(0,c.jsxs)("div",{className:"edit-container",children:[(0,c.jsx)("textarea",{value:b,onChange:e=>v(e.target.value),className:"edit-textarea",autoFocus:!0}),(0,c.jsxs)("div",{className:"edit-buttons",children:[(0,c.jsx)("button",{onClick:()=>(async n=>{if(!b.trim())return;const s=e.findIndex(e=>e.id===n);if(-1===s)return;const r=e[s];if("user"!==r.type)return;const i=w(e.slice(0,s)),a=w(e.slice(s+1)),l=b.trim();g(e=>{const t=o({},e);return t[n]||(t[n]={messageId:n,versions:[{id:N(),content:r.content,suffix:a,createdAt:Date.now()}],currentIndex:0}),t}),g(e=>{const t=e[n],s={id:N(),content:l,suffix:[],createdAt:Date.now()};return o(o({},e),{},{[n]:{messageId:n,versions:[...t.versions,s],currentIndex:t.versions.length}})});const c=[...i,o(o({},r),{},{content:l})];t(c),f(null),v(""),await S(c)})(n.id),disabled:r||!b.trim(),className:"save-button",children:"Save"}),(0,c.jsx)("button",{onClick:O,disabled:r,className:"cancel-button",children:"Cancel"})]})]}):(0,c.jsxs)("div",{className:"message-wrapper",children:[(0,c.jsx)("div",{className:"message-content",children:m(n)}),"user"===n.type&&(0,c.jsx)("button",{onClick:()=>(e=>{f(e.id),v(e.content)})(n),className:"edit-button",disabled:r,children:"Edit"}),a&&(0,c.jsxs)("div",{className:"navigation-buttons",children:[(0,c.jsx)("button",{onClick:()=>k(n.id,-1),className:"nav-button",disabled:r||!l,"aria-label":"Previous version",title:"Previous edited version",children:"<"}),(0,c.jsxs)("span",{className:"nav-indicator",children:[i.currentIndex+1,"/",i.versions.length]}),(0,c.jsx)("button",{onClick:()=>k(n.id,1),className:"nav-button",disabled:r||!d,"aria-label":"Next version",title:"Next edited version",children:">"})]})]})},n.id)}),r&&(0,c.jsx)("div",{className:"message assistant",children:(0,c.jsxs)("div",{className:"loading",children:[(0,c.jsx)("span",{}),(0,c.jsx)("span",{}),(0,c.jsx)("span",{})]})}),a&&(0,c.jsxs)("div",{className:"error-message",children:["Error: ",a]}),(0,c.jsx)("div",{ref:y})]}),(0,c.jsxs)("form",{onSubmit:async r=>{if(r.preventDefault(),!n.trim())return;const i=n.trim();s(""),d(null);const a={type:"user",content:i,id:Date.now().toString()},o=[...e,a];t(o),await S(o)},className:"input-form",children:[(0,c.jsx)("input",{ref:j,type:"text",value:n,onChange:e=>s(e.target.value),placeholder:"Type your message...",className:"input-box",disabled:r}),(0,c.jsx)("button",{type:"submit",disabled:r||!n.trim(),children:"Send"})]})]}),(0,c.jsx)("button",{type:"button",className:"reset-btn",onClick:()=>{var e;window.confirm("Clear all messages and history?")&&(t([]),g({}),f(null),v(""),d(null),null===(e=j.current)||void 0===e||e.focus())},"aria-label":"Reset all messages",title:"Reset",children:"Reset"}),(0,c.jsx)("div",{className:"quickbar",children:u.map(n=>(0,c.jsx)("button",{type:"button",className:"quick-btn",title:n.text,"aria-label":n.text,disabled:r,onClick:()=>(async n=>{if(!n||r)return;d(null);const s={type:"user",content:n,id:Date.now().toString()},i=[...e,s];t(i),await S(i)})(n.text),style:{backgroundImage:"url(".concat(n.bg,")")}},n.id))})]})}}}]);
//# sourceMappingURL=251.bfe511aa.chunk.js.map