"use strict";(self.webpackChunkreact_dev=self.webpackChunkreact_dev||[]).push([[251],{251:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function i(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.r(t),n.d(t,{default:()=>h,formatRollResults:()=>v,rollDice:()=>f,rollFromText:()=>p,rollOnce:()=>m,trimMessage:()=>d});var a=n(43),l=n(579);const u=/(?<!\d)(\d*)\s*[dD]\s*(\d+)(?!\d)/g;function d(e){const t=[];let n;for(;null!==(n=u.exec(e));){const e=n[1]?parseInt(n[1],10):1,r=parseInt(n[2],10);e>0&&r>0&&t.push({count:e,sides:r,raw:n[0].trim()})}return t}function m(e){return Math.floor(Math.random()*e)+1}function f(e,t){const n=Array.from({length:e},()=>m(t)),r=n.reduce((e,t)=>e+t,0);return{rolls:n,total:r}}function p(e){return d(e).map(e=>c({spec:e},f(e.count,e.sides)))}function v(e){if(!e||0===e.length)return null;const t=e.map((e,t)=>{const n=e.rolls.join(", ");return"Results : ".concat(e.total,"      (").concat(n,")")});if(e.length>1){const n=e.reduce((e,t)=>e+t.total,0);t.push("Total Sum: ".concat(n))}return t.join("\n")}function h(){const[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)(""),[s,i]=(0,a.useState)(!1),[o,u]=(0,a.useState)(null),[d,m]=(0,a.useState)(null),[f,h]=(0,a.useState)(""),[b,x]=(0,a.useState)({}),y=(0,a.useRef)(null),g=(0,a.useRef)(null),j=()=>{var e;return null!==(e=crypto)&&void 0!==e&&e.randomUUID?crypto.randomUUID():Date.now().toString()},w=e=>e.map(e=>c({},e)),N=(e,t)=>e.length===t.length&&e.every((e,n)=>e.id===t[n].id&&e.type===t[n].type&&e.content===t[n].content);(0,a.useEffect)(()=>{x(t=>{let n=!1;const r=c({},t);for(const[s,i]of Object.entries(t)){const t=e.findIndex(e=>e.id===s);if(-1!==t){const o=w(e.slice(t+1)),a=i.versions[i.currentIndex];if(!N(a.suffix,o)){const e=i.versions.slice();e[i.currentIndex]=c(c({},a),{},{suffix:o}),r[s]=c(c({},i),{},{versions:e}),n=!0}}}return n?r:t}),(()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[e]);const I=async e=>{i(!0),u(null);try{var n;const r=[...e].reverse().find(e=>"human"===e.type),s=p(null!==(n=null===r||void 0===r?void 0:r.content)&&void 0!==n?n:""),i=s.length?v(s):" ";t(e=>[...e,{type:"robot",content:i,id:j()}])}finally{var r;i(!1),null===(r=g.current)||void 0===r||r.focus()}},S=()=>{m(null),h("")},O=(e,n)=>{x(r=>{const s=r[e];if(!s)return r;const i=Math.max(0,Math.min(s.versions.length-1,s.currentIndex+n));if(i===s.currentIndex)return r;const o=s.versions[i];return t(t=>{const n=t.findIndex(t=>t.id===e);if(-1===n)return t;return[...w(t.slice(0,n)),c(c({},t[n]),{},{content:o.content}),...w(o.suffix)]}),c(c({},r),{},{[e]:c(c({},s),{},{currentIndex:i})})})};return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"dice_instruction",children:[(0,l.jsx)("p",{children:"Please type \"number of dice + 'd' + number of sides on the dice\" to roll the dice"}),(0,l.jsx)("p",{children:"This app is aim to log and track your dice numbers and what happens when playing table games"}),(0,l.jsx)("p",{children:"Feel free to type some notes, it will keep your notes until you reload this web page"}),(0,l.jsx)("p",{children:"Example of use:"}),(0,l.jsx)("p",{children:'"I got damaged from a ghoul, received damage 1 d 6"'}),(0,l.jsx)("p",{children:'"I obsered a murder, my sanity got hurt 1 d 4"'})]}),(0,l.jsxs)("div",{className:"chat-container",children:[(0,l.jsxs)("div",{className:"messages",children:[e.map(n=>{const r=d===n.id,i=b[n.id],o=!!i&&i.versions.length>=1,a=o&&i.currentIndex>0,u=o&&i.currentIndex<i.versions.length-1;return(0,l.jsx)("div",{className:"message ".concat(n.type),children:r?(0,l.jsxs)("div",{className:"edit-container",children:[(0,l.jsx)("textarea",{value:f,onChange:e=>h(e.target.value),className:"edit-textarea",autoFocus:!0}),(0,l.jsxs)("div",{className:"edit-buttons",children:[(0,l.jsx)("button",{onClick:()=>(async n=>{if(!f.trim())return;const r=e.findIndex(e=>e.id===n);if(-1===r)return;const s=e[r];if("human"!==s.type)return;const i=w(e.slice(0,r)),o=w(e.slice(r+1)),a=f.trim();x(e=>{const t=c({},e);return t[n]||(t[n]={messageId:n,versions:[{id:j(),content:s.content,suffix:o,createdAt:Date.now()}],currentIndex:0}),t}),x(e=>{const t=e[n],r={id:j(),content:a,suffix:[],createdAt:Date.now()};return c(c({},e),{},{[n]:{messageId:n,versions:[...t.versions,r],currentIndex:t.versions.length}})});const l=[...i,c(c({},s),{},{content:a})];t(l),m(null),h(""),await I(l)})(n.id),disabled:s||!f.trim(),className:"save-button",children:"Save"}),(0,l.jsx)("button",{onClick:S,disabled:s,className:"cancel-button",children:"Cancel"})]})]}):(0,l.jsxs)("div",{className:"message-wrapper",children:[(0,l.jsx)("div",{className:"message-content",children:n.content}),"human"===n.type&&(0,l.jsx)("button",{onClick:()=>(e=>{m(e.id),h(e.content)})(n),className:"edit-button",disabled:s,children:"Edit"}),o&&(0,l.jsxs)("div",{className:"navigation-buttons",children:[(0,l.jsx)("button",{onClick:()=>O(n.id,-1),className:"nav-button",disabled:s||!a,"aria-label":"Previous version",title:"Previous edited version",children:"<"}),(0,l.jsxs)("span",{className:"nav-indicator",children:[i.currentIndex+1,"/",i.versions.length]}),(0,l.jsx)("button",{onClick:()=>O(n.id,1),className:"nav-button",disabled:s||!u,"aria-label":"Next version",title:"Next edited version",children:">"})]})]})},n.id)}),s&&(0,l.jsx)("div",{className:"message assistant",children:(0,l.jsxs)("div",{className:"loading",children:[(0,l.jsx)("span",{}),(0,l.jsx)("span",{}),(0,l.jsx)("span",{})]})}),o&&(0,l.jsxs)("div",{className:"error-message",children:["Error: ",o]}),(0,l.jsx)("div",{ref:y})]}),(0,l.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),!n.trim())return;const i=n.trim();r(""),u(null);const o={type:"human",content:i,id:Date.now().toString()},c=[...e,o];t(c),await I(c)},className:"input-form",children:[(0,l.jsx)("input",{ref:g,type:"text",value:n,onChange:e=>r(e.target.value),placeholder:"Type your message...",className:"input-box",disabled:s}),(0,l.jsx)("button",{type:"submit",disabled:s||!n.trim(),children:"Send"})]})]})]})}}}]);
//# sourceMappingURL=251.6edb897c.chunk.js.map