"use strict";(self.webpackChunkreact_dev=self.webpackChunkreact_dev||[]).push([[251],{251:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function i(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.r(t),n.d(t,{default:()=>b,formatRollResults:()=>v,rollDice:()=>f,rollFromText:()=>p,rollOnce:()=>m,trimMessage:()=>u});var a=n(43),c=n(579);const d=/(?<!\d)(\d*)\s*[dD]\s*(\d+)(?!\d)/g;function u(e){const t=[];let n;for(;null!==(n=d.exec(e));){const e=n[1]?parseInt(n[1],10):1,r=parseInt(n[2],10);e>0&&r>0&&t.push({count:e,sides:r,raw:n[0].trim()})}return t}function m(e){return Math.floor(Math.random()*e)+1}function f(e,t){const n=Array.from({length:e},()=>m(t)),r=n.reduce((e,t)=>e+t,0);return{rolls:n,total:r}}function p(e){return u(e).map(e=>l({spec:e},f(e.count,e.sides)))}function v(e){if(!e||0===e.length)return null;const t=e.map((e,t)=>{const n=e.rolls.join(", ");return(0,c.jsxs)("div",{className:"dice-line",children:["Results :"," ",(0,c.jsx)("span",{className:"dice-total",children:e.total}),"  (",(0,c.jsx)("span",{className:"dice-rolls",children:n}),")"]},t)});if(e.length>1){const n=e.reduce((e,t)=>e+t.total,0);t.push((0,c.jsxs)("div",{className:"dice-grand",children:["Total Sum: ",(0,c.jsx)("span",{className:"dice-grand-total",children:n})]},"grand"))}return(0,c.jsx)("div",{className:"dice-results",children:t})}const h=e=>{var t;return"reply"===e.type&&"roll"===(null===(t=e.content)||void 0===t?void 0:t.kind)?v(e.content.results):e.content};function b(){const[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)(""),[s,i]=(0,a.useState)(!1),[o,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),[f,v]=(0,a.useState)(""),[b,x]=(0,a.useState)({}),y=(0,a.useRef)(null),j=(0,a.useRef)(null),g=()=>{var e;return null!==(e=crypto)&&void 0!==e&&e.randomUUID?crypto.randomUUID():Date.now().toString()},N=e=>e.map(e=>l({},e)),w=(e,t)=>e.length===t.length&&e.every((e,n)=>e.id===t[n].id&&e.type===t[n].type&&e.content===t[n].content);(0,a.useEffect)(()=>{x(t=>{let n=!1;const r=l({},t);for(const[s,i]of Object.entries(t)){const t=e.findIndex(e=>e.id===s);if(-1!==t){const o=N(e.slice(t+1)),a=i.versions[i.currentIndex];if(!w(a.suffix,o)){const e=i.versions.slice();e[i.currentIndex]=l(l({},a),{},{suffix:o}),r[s]=l(l({},i),{},{versions:e}),n=!0}}}return n?r:t}),(()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[e]);const I=async e=>{i(!0),d(null);try{var n;const r=[...e].reverse().find(e=>"user"===e.type),s=p(null!==(n=null===r||void 0===r?void 0:r.content)&&void 0!==n?n:"");if(!s.length)return;t(e=>[...e,{type:"reply",content:{kind:"roll",results:s},id:g()}])}finally{var r;i(!1),null===(r=j.current)||void 0===r||r.focus()}},S=()=>{m(null),v("")},O=(e,n)=>{x(r=>{const s=r[e];if(!s)return r;const i=Math.max(0,Math.min(s.versions.length-1,s.currentIndex+n));if(i===s.currentIndex)return r;const o=s.versions[i];return t(t=>{const n=t.findIndex(t=>t.id===e);if(-1===n)return t;return[...N(t.slice(0,n)),l(l({},t[n]),{},{content:o.content}),...N(o.suffix)]}),l(l({},r),{},{[e]:l(l({},s),{},{currentIndex:i})})})};return(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"dice-title",children:(0,c.jsx)("strong",{children:"\ud83c\udfb2 Table Dice Roller \ud83c\udfb2"})}),(0,c.jsxs)("div",{className:"dice-instruction",children:[(0,c.jsx)("p",{children:"Please type \"number of dice + 'd' + number of sides on the dice\" to roll the dice"}),(0,c.jsx)("p",{children:"This app is aimed to log and track your dice numbers and what happens when playing table games"}),(0,c.jsx)("p",{children:"Feel free to type some notes, it will keep your notes until you reload this web page"}),(0,c.jsx)("p",{children:"Example of use:"}),(0,c.jsx)("p",{children:'"I got damaged from a ghoul, received damage 1 d 6"'}),(0,c.jsx)("p",{children:'"I observed a murder, my sanity got hurt 1 d 4"'})]}),(0,c.jsxs)("div",{className:"chat-container",children:[(0,c.jsxs)("div",{className:"messages",children:[e.map(n=>{const r=u===n.id,i=b[n.id],o=!!i&&i.versions.length>=1,a=o&&i.currentIndex>0,d=o&&i.currentIndex<i.versions.length-1;return(0,c.jsx)("div",{className:"message ".concat(n.type),children:r?(0,c.jsxs)("div",{className:"edit-container",children:[(0,c.jsx)("textarea",{value:f,onChange:e=>v(e.target.value),className:"edit-textarea",autoFocus:!0}),(0,c.jsxs)("div",{className:"edit-buttons",children:[(0,c.jsx)("button",{onClick:()=>(async n=>{if(!f.trim())return;const r=e.findIndex(e=>e.id===n);if(-1===r)return;const s=e[r];if("user"!==s.type)return;const i=N(e.slice(0,r)),o=N(e.slice(r+1)),a=f.trim();x(e=>{const t=l({},e);return t[n]||(t[n]={messageId:n,versions:[{id:g(),content:s.content,suffix:o,createdAt:Date.now()}],currentIndex:0}),t}),x(e=>{const t=e[n],r={id:g(),content:a,suffix:[],createdAt:Date.now()};return l(l({},e),{},{[n]:{messageId:n,versions:[...t.versions,r],currentIndex:t.versions.length}})});const c=[...i,l(l({},s),{},{content:a})];t(c),m(null),v(""),await I(c)})(n.id),disabled:s||!f.trim(),className:"save-button",children:"Save"}),(0,c.jsx)("button",{onClick:S,disabled:s,className:"cancel-button",children:"Cancel"})]})]}):(0,c.jsxs)("div",{className:"message-wrapper",children:[(0,c.jsx)("div",{className:"message-content",children:h(n)}),"user"===n.type&&(0,c.jsx)("button",{onClick:()=>(e=>{m(e.id),v(e.content)})(n),className:"edit-button",disabled:s,children:"Edit"}),o&&(0,c.jsxs)("div",{className:"navigation-buttons",children:[(0,c.jsx)("button",{onClick:()=>O(n.id,-1),className:"nav-button",disabled:s||!a,"aria-label":"Previous version",title:"Previous edited version",children:"<"}),(0,c.jsxs)("span",{className:"nav-indicator",children:[i.currentIndex+1,"/",i.versions.length]}),(0,c.jsx)("button",{onClick:()=>O(n.id,1),className:"nav-button",disabled:s||!d,"aria-label":"Next version",title:"Next edited version",children:">"})]})]})},n.id)}),s&&(0,c.jsx)("div",{className:"message assistant",children:(0,c.jsxs)("div",{className:"loading",children:[(0,c.jsx)("span",{}),(0,c.jsx)("span",{}),(0,c.jsx)("span",{})]})}),o&&(0,c.jsxs)("div",{className:"error-message",children:["Error: ",o]}),(0,c.jsx)("div",{ref:y})]}),(0,c.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),!n.trim())return;const i=n.trim();r(""),d(null);const o={type:"user",content:i,id:Date.now().toString()},l=[...e,o];t(l),await I(l)},className:"input-form",children:[(0,c.jsx)("input",{ref:j,type:"text",value:n,onChange:e=>r(e.target.value),placeholder:"Type your message...",className:"input-box",disabled:s}),(0,c.jsx)("button",{type:"submit",disabled:s||!n.trim(),children:"Send"})]})]}),(0,c.jsx)("button",{type:"button",className:"reset-btn",onClick:()=>{var e;window.confirm("Clear all messages and history?")&&(t([]),x({}),m(null),v(""),d(null),null===(e=j.current)||void 0===e||e.focus())},"aria-label":"Reset all messages",title:"Reset",children:"Reset"})]})}}}]);
//# sourceMappingURL=251.7c7b0d77.chunk.js.map